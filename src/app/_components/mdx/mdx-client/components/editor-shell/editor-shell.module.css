/* 编辑器外壳容器 */
.shell {
  display: flex;
  flex-direction: column;
  height: 1000px;
  overflow: hidden;
  background: var(--background);
  border: 1.5px solid oklch(88% 0.01 260deg);
  border-radius: 0.75rem;
  box-shadow: 0 2px 8px oklch(0% 0 0deg / 5%);
}

:global(.dark) .shell {
  border-color: oklch(35% 0.02 260deg);
  box-shadow: 0 2px 8px oklch(0% 0 0deg / 20%);
}

/* 工具栏 */
.toolbar {
  display: flex;
  gap: 0.5rem;
  padding: 0.75rem 1rem;
  background: oklch(98% 0.005 260deg);
  border-bottom: 1px solid oklch(92% 0.01 260deg);
}

:global(.dark) .toolbar {
  background: oklch(18% 0.01 260deg);
  border-bottom-color: oklch(30% 0.02 260deg);
}

/* 模式按钮 */
.modeButton {
  padding: 0.5rem 1rem;
  font-size: 0.875rem;
  font-weight: 500;
  color: oklch(50% 0.05 260deg);
  cursor: pointer;
  background: transparent;
  border: 1px solid oklch(88% 0.01 260deg);
  border-radius: 0.5rem;
  transition: all 0.2s ease;
}

.modeButton:hover {
  color: oklch(40% 0.1 260deg);
  background: oklch(96% 0.005 260deg);
  border-color: oklch(75% 0.05 260deg);
}

.modeButton.active {
  color: oklch(100% 0 0deg);
  background: linear-gradient(135deg, oklch(55% 0.18 260deg) 0%, oklch(50% 0.2 280deg) 100%);
  border-color: transparent;
  box-shadow: 0 2px 8px oklch(55% 0.18 260deg / 30%);
}

:global(.dark) .modeButton {
  color: oklch(70% 0.05 260deg);
  border-color: oklch(35% 0.02 260deg);
}

:global(.dark) .modeButton:hover {
  color: oklch(80% 0.08 260deg);
  background: oklch(25% 0.015 260deg);
  border-color: oklch(50% 0.05 260deg);
}

:global(.dark) .modeButton.active {
  color: oklch(100% 0 0deg);
  background: linear-gradient(135deg, oklch(55% 0.18 260deg) 0%, oklch(50% 0.2 280deg) 100%);
  border-color: transparent;
}

/* 内容区域 */
.content {
  display: flex;
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

/* 编辑器面板 */
.editorPane {
  flex: 1;
  min-height: 0;
  overflow: hidden;
}

/* 预览面板 */
.previewPane {
  overflow: auto;
  background: var(--background);
}

/* 编辑器内部滚动链路 */
:global(.w-md-editor) {
  height: 100%;
  max-height: 100%;
  overflow: hidden;
}

:global(.w-md-editor-content) {
  height: 100%;
  min-height: 0;
  overflow: hidden;
}

:global(.w-md-editor-area) {
  height: 100%;
  min-height: 0;
  overflow: auto;
}

/* 
  以下进行了许多的样式覆盖，主要是因为部分标签同时存在于 MDX编辑器 和 全局 MDX 样式中，
  全局 MDX 样式会对编辑器内的标签产生影响，导致编辑器内的显示异常。
  这些覆盖主要集中在字体、行高、换行、预览层 <pre> 样式等方面。

  TODO：对于光标错位的问题仍然没有解决
*/

/* 保证输入层与渲染层的字体/行高一致，避免光标错位 */
:global(.w-md-editor-text),
:global(.w-md-editor-text-input),
:global(.w-md-editor-text-pre),
:global(.w-md-editor-text-pre > code),
:global(.wmde-markdown-color),
:global(.wmde-markdown-color pre),
:global(.wmde-markdown-color code),
:global(.w-md-editor-markdown-color),
:global(.w-md-editor-markdown-color pre),
:global(.w-md-editor-markdown-color code) {
  font-family: var(--font-code) !important;
  font-size: 14px !important;
  line-height: 20px !important;
  letter-spacing: 0;
  tab-size: 2;
}

/* 关闭连字，避免 textarea 与高亮层字形不一致导致错位 */
:global(.w-md-editor-text),
:global(.w-md-editor-text-input),
:global(.w-md-editor-text-pre) {
  font-feature-settings:
    'liga' 0,
    'calt' 0;
  font-variant-ligatures: none;
}

/* 强制编辑层使用同样的换行/断词规则 */
:global(.w-md-editor-text-input),
:global(.w-md-editor-text-pre),
:global(.w-md-editor-text-pre > code),
:global(.wmde-markdown-color),
:global(.wmde-markdown-color pre),
:global(.w-md-editor-markdown-color),
:global(.w-md-editor-markdown-color pre) {
  word-break: break-all;
  white-space: pre-wrap;
}

/* 覆盖全局 mdx 样式，避免预览层 <pre> 被限制高度导致滚动失效 */
:global(.w-md-editor .w-md-editor-text-pre),
:global(.w-md-editor .w-md-editor-text-pre > code),
:global(.w-md-editor pre),
:global(.w-md-editor .wmde-markdown-color pre),
:global(.w-md-editor .w-md-editor-markdown-color pre) {
  /**
  覆盖 mdx.css 里对 pre 的 max-height: 50rem 限制。这个限制会让代码块自己形成滚动，干扰编辑器的整体滚动。 */
  max-height: none;
  padding: 0;

  /* 去掉 mdx.css 对 pre 的 padding/margin，避免输入层与渲染层错位 */
  margin: 0;

  /** 防止 pre 自己出现滚动条，把滚动交给 .w-md-editor-area 统一处理。 */
  overflow: visible;
}

/* 取消 mdx.css 对 code block 的浮动，避免横向滚动条卡死 */
:global(.w-md-editor pre[class*='language-'] code) {
  float: none;
}

/* 拖拽分隔条 */
.resizeHandle {
  position: relative;
  z-index: 10;
  display: flex;
  flex-shrink: 0;
  align-items: center;
  justify-content: center;
  width: 8px;
  cursor: col-resize;
  background: oklch(92% 0.01 260deg);
  transition: background 0.2s ease;
}

.resizeHandle:hover,
.shell.dragging .resizeHandle {
  background: oklch(75% 0.05 260deg);
}

:global(.dark) .resizeHandle {
  background: oklch(30% 0.02 260deg);
}

:global(.dark) .resizeHandle:hover,
:global(.dark) .shell.dragging .resizeHandle {
  background: oklch(50% 0.05 260deg);
}

/* 拖拽条中间的竖线 */
.resizeHandleBar {
  width: 2px;
  height: 40px;
  background: oklch(100% 0 0deg / 40%);
  border-radius: 1px;
  transition: height 0.2s ease;
}

.resizeHandle:hover .resizeHandleBar,
.shell.dragging .resizeHandleBar {
  height: 60px;
  background: oklch(100% 0 0deg / 60%);
}

/* 拖拽时的全局光标 */
.shell.dragging {
  cursor: col-resize;
  user-select: none;
}

/* 移动端适配 */
@media (width <= 768px) {
  .shell {
    height: 500px;
    min-height: 350px;
  }

  /* 移动端强制垂直布局 */
  .content {
    flex-direction: column;
  }

  .editorPane,
  .previewPane {
    flex-basis: 50% !important;
    height: 100%;
  }

  /* 移动端拖拽条改为水平 */
  .resizeHandle {
    width: 100%;
    height: 8px;
    cursor: row-resize;
  }

  .resizeHandleBar {
    width: 40px;
    height: 2px;
  }

  .resizeHandle:hover .resizeHandleBar,
  .shell.dragging .resizeHandleBar {
    width: 60px;
    height: 2px;
  }

  .shell.dragging {
    cursor: row-resize;
  }
}
